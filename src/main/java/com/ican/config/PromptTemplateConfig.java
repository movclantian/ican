package com.ican.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * 提示词模板配置类
 * 集中管理所有的提示词模板，便于维护和优化
 * 
 * @author ICan
 * @since 2024-10-08
 */
@Configuration
public class PromptTemplateConfig {
    
    /**
     * RAG 问答提示词模板（精简版）
     */
    @Bean("ragQAPromptTemplate")
    public String ragQAPromptTemplate() {
        return """
            你是学术研究助手,基于参考资料回答问题。
            
            问题: {question}
            
            要求:
            1. 严格基于资料,不编造信息
            2. 结构化回答:先总述,再分点详述,最后总结
            3. 重要信息用**加粗**标记
            4. 200-600字,层次清晰
            5. 资料不足时明确说明
            """;
    }
    
    /**
     * 文档问答提示词模板（精简版）
     */
    @Bean("documentQAPromptTemplate")
    public String documentQAPromptTemplate() {
        return """
            你是文档分析专家,基于文档内容回答问题。
            
            问题: {question}
            
            要求:
            1. 严格基于文档原文,标注来源
            2. 先总述后详述,重点**加粗**
            3. 根据问题类型调整:事实查询列举式,分析类解释式,对比类表格式
            4. 200-600字,层次清晰
            5. 内容不足时明确说明
            """;
    }
    
    /**
     * 教学设计生成提示词模板（精简版 - 强约束JSON格式）
     */
    @Bean("teachingPlanPromptTemplate")
    public String teachingPlanPromptTemplate() {
        return """
            生成教学设计JSON:
            课题: {topic}
            学段: {grade}
            学科: {subject}
            参考: {context}
            
            JSON结构(参考示例但需根据实际课题调整):

            {
              "title": "《分数的初步认识》教学设计",
              "grade": "三年级",
              "subject": "数学",
              "duration": "1课时（40分钟）",
              "objectives": {
                "knowledge": [
                  "理解分数的意义，认识分数是表示部分与整体关系的数",
                  "掌握分数的各部分名称（分子、分母、分数线）及其含义",
                  "能正确读写1/2、1/3、1/4等简单分数",
                  "理解'平均分'是分数产生的前提条件"
                ],
                "skills": [
                  "能用分数表示简单的部分与整体关系，解决生活中的实际问题",
                  "通过折纸、涂色等操作活动培养动手实践能力",
                  "培养观察、比较、抽象概括和语言表达能力",
                  "发展数学建模思维，学会用数学语言描述生活现象"
                ],
                "values": [
                  "感受数学与生活的紧密联系，体会数学的应用价值",
                  "培养合作交流意识和团队协作精神",
                  "激发学习数学的兴趣和探究欲望",
                  "树立严谨认真的学习态度"
                ]
              },
              "keyPoints": [
                "理解分数的意义：把一个物体或一个整体平均分成若干份，表示这样的一份或几份的数叫做分数",
                "认识分数各部分名称：分数线表示平均分，分母表示平均分的份数，分子表示所取的份数",
                "掌握分数的读写方法：读作'几分之几'，写时先写分数线，再写分母，最后写分子",
                "理解'平均分'是分数产生的前提：只有平均分才能用分数表示"
              ],
              "difficulties": [
                "理解分数表示部分与整体的关系：从整体中分出部分的抽象过程",
                "认识分数的本质含义：分数既表示分的结果，又表示两个量之间的关系",
                "区分'平均分'和'不平均分'：理解为什么不平均分不能用分数表示",
                "从具体的分数实例中抽象出一般的分数概念"
              ],
              "teachingSteps": [
                {
                  "step": 1,
                  "name": "情境导入",
                  "duration": "5分钟",
                  "content": "通过生活中分月饼的真实情境创设问题,激发学生的学习兴趣和探究欲望。首先展示一个圆形月饼的实物图片,提问：'中秋节到了,妈妈买了一个月饼,要平均分给小明和小红两个人,每人得到多少?'引导学生用生活经验回答'一半'。紧接着追问：'一半可以用我们学过的数字表示吗?1? 0.5?'制造认知冲突,让学生意识到已学的整数和小数都无法准确表示'一半',自然引出学习新数的必要性。板书课题:分数的初步认识。通过这个环节,让学生体会数学来源于生活,激发学习新知识的内在动机。",
                  "activities": [
                    "【0-1分钟】教师展示月饼实物图片,创设中秋节分月饼的生活情境",
                    "【1-2分钟】提出核心问题：'把一个月饼平均分给2个人,每人得多少?'学生自由发言,说出'一半'",
                    "【2-3分钟】教师追问：'一半可以用数字表示吗?用1行吗?用0.5行吗?'引发认知冲突",
                    "【3-4分钟】学生小组讨论：我们学过的数能表示'一半'吗?为什么?",
                    "【4-5分钟】教师小结：今天我们要学习一种新的数—分数,它可以表示'一半'。板书课题",
                    "【设计意图】从生活经验出发,制造认知冲突,激发学习动机",
                    "【预期效果】学生能感受到学习新知识的必要性,产生探究兴趣"
                  ]
                },
                {
                  "step": 2,
                  "name": "新知探究与概念建构",
                  "duration": "20分钟",
                  "content": "这是本节课的核心环节,通过'操作感知→语言表达→符号抽象'三个层次,帮助学生建立分数概念。首先分发圆形纸片,引导学生用折纸的方式创造'二分之一',鼓励学生尝试不同的折法(对折、斜折等)。通过小组展示交流,让学生发现：虽然折法不同,但只要是把圆平均分成2份,其中的1份都可以用二分之一表示,渗透'平均分'的本质。接着教师规范讲解分数的写法和读法,板书分数各部分名称。然后追问：'如果平均分成3份、4份,取其中的1份,怎么表示?'引导学生类推出1/3、1/4,初步感知分数的一般形式。最后通过多种实物(长方形纸条、正方形、线段)的平均分活动,帮助学生理解分数的意义从具体到抽象的迁移,突破'部分与整体'这一难点。整个过程注重学生的动手操作、语言表达和思维参与,体现'做中学'的理念。",
                  "activities": [
                    "【5-7分钟】教师分发圆形纸片,提出任务：'请用折纸的方法,把圆平均分成2份,并用彩笔涂出其中的1份'",
                    "【7-10分钟】学生独立操作,教师巡视指导,关注不同折法(横折、竖折、斜折),拍照记录典型作品",
                    "【10-13分钟】小组展示：投影展示3-4种不同折法,提问：'虽然折法不同,为什么涂色部分都是一样大?'引导学生说出'平均分'",
                    "【13-16分钟】教师规范讲解：板书1/2,讲解分数线、分母、分子的含义。分数线表示平均分,分母2表示平均分成2份,分子1表示取其中的1份",
                    "【16-18分钟】类推练习：'如果平均分成3份、4份,取1份怎么表示?'学生尝试写出1/3、1/4,同桌互相检查",
                    "【18-20分钟】拓展活动：用长方形纸条折出1/2、1/4,讨论：不同形状的物体,只要平均分,就可以用分数表示",
                    "【20-22分钟】教师追问：'如果不是平均分,可以用分数表示吗?'出示反例图片,强化'平均分'的本质",
                    "【22-25分钟】练习读写：教师写分数学生读,学生写分数同桌读,巩固读写方法",
                    "【设计意图】通过多感官参与建立分数表象,突破'部分与整体'的难点",
                    "【评价方式】观察学生操作正确性,倾听语言表达完整性,检查书写规范性"
                  ]
                },
                {
                  "step": 3,
                  "name": "巩固练习与能力提升",
                  "duration": "10分钟",
                  "content": "设计分层递进的练习题组,既巩固基础知识,又培养应用能力和思辨能力。第一层次是基础判断题,呈现多组图形,有的平均分有的不平均分,有的涂色正确有的涂色错误,让学生判断涂色部分是否表示指定分数,强化'平均分'和'部分与整体'的理解。第二层次是应用题,将分数概念应用到生活情境：'把8个苹果平均分给4个人,每人得这些苹果的几分之几?'重点引导学生理解整体是8个苹果,平均分成4份,每人得1份,是8个苹果的1/4。第三层次是开放性问题：'找一找生活中哪些地方用到了分数?'鼓励学生联系生活实际,分享自己的发现。整个练习过程采用'独立完成→同桌交流→集体订正'的方式,及时反馈,确保每个学生都能达到学习目标。",
                  "activities": [
                    "【25-27分钟】基础判断练习：PPT呈现6组图形,学生用手势(√或×)判断涂色部分是否表示指定分数,说明理由",
                    "【27-29分钟】教师点评重点错例,追问：'为什么这个不能用1/2表示?'强化'平均分'概念",
                    "【29-31分钟】应用题练习：'把8个苹果平均分给4个人,每人得几分之几?'学生独立完成,写出思考过程",
                    "【31-33分钟】学生展示解题思路：'整体是8个苹果,平均分成4份,每人得1份,是8个的1/4'",
                    "【33-35分钟】拓展变式：'如果是12个苹果平均分给4个人呢?'引导学生举一反三",
                    "【35分钟】开放性活动：'生活中哪里用到了分数?'学生自由分享(如：半个西瓜、四分之一个披萨、三分之二杯水等)",
                    "【设计意图】分层练习照顾不同层次学生,开放性问题培养应用意识",
                    "【即时反馈】教师巡视收集错误信息,针对性讲评"
                  ]
                },
                {
                  "step": 4,
                  "name": "课堂总结与拓展延伸",
                  "duration": "5分钟",
                  "content": "通过师生共同回顾,系统梳理本节课的核心知识,建构完整的知识网络。采用'学生说→教师补充→知识建构'的方式进行总结。首先让学生回顾：'今天我们学习了什么新数?分数是怎么产生的?分数各部分叫什么名字?'引导学生用自己的语言总结。教师在学生发言基础上,用思维导图的形式板书知识结构：分数的产生(平均分)→分数的意义(部分与整体)→分数的各部分名称→分数的读写。特别强调'平均分'是分数的本质,为后续学习分数的大小比较、分数的运算等内容埋下伏笔。最后拓展延伸,布置开放性作业,鼓励学生在生活中发现数学,用数学眼光观察世界,提升数学应用意识和创新思维能力。通过评价表进行自我评价和互评,培养学生的元认知能力和反思意识。",
                  "activities": [
                    "【35-37分钟】学生自主总结：'今天我们认识了一种新的数—分数,你能说说什么是分数吗?'3-4名学生发言",
                    "【37-38分钟】教师补充完善：边总结边板书思维导图,呈现知识结构：平均分→分数的意义→各部分名称→读写方法",
                    "【38-39分钟】强调重点：'记住,只有平均分才能用分数表示,这是分数最重要的特点'",
                    "【39-40分钟】布置作业：1)完成练习册;2)寻找生活中的分数并拍照记录;3)思考:如果平均分成2份,取2份,是几分之几?",
                    "【40分钟】自我评价：学生填写'今天我学会了/我还不懂的是/我最感兴趣的是'学习反思卡",
                    "【设计意图】系统梳理知识,培养反思习惯,激发持续探究兴趣",
                    "【课后延伸】作业设计体现分层,既有基础巩固又有实践探究,满足不同学生需求"
                  ]
                }
              ],
              "assignments": [
                "【基础作业】完成练习册第12-13页习题,重点练习分数的读写和简单应用(全体学生必做,预计用时15分钟)",
                "【实践作业】用手机拍摄生活中使用分数的3-5个场景(如商品标签、菜谱、路标等),并用分数符号标注出来(全体学生必做,培养应用意识)",
                "【探究作业】思考题：如果把一个圆平均分成2份,取2份,应该怎么表示?画图说明你的想法(学有余力的学生选做,为后续学习铺垫)",
                "【创意作业】用折纸、剪纸或绘画的方式,制作一幅'分数主题'的创意作品,并写一句话介绍你的作品(激发兴趣,培养创新能力)",
                "【家庭互动】和爸爸妈妈一起分享今天学到的分数知识,并请家长在'家校联系本'上签字确认(促进家校合作)"
              ],
              "resources": [
                "多媒体PPT课件(含月饼情境图片、分数示意图、动画演示平均分过程、练习题等,共25页)",
                "圆形纸片(红色和黄色各一张,直径10cm,用于折纸操作,每生2张)",
                "长方形纸条(白色A4纸裁剪,15cm×3cm,用于拓展活动,每生2张)",
                "彩色水彩笔(用于涂色标记,每组一盒)",
                "分数卡片(1/2、1/3、1/4、1/8等,用于认读练习,教师准备20张)",
                "练习题单(包含判断题、填空题、应用题三个部分,每生一份)",
                "实物投影仪(用于展示学生作品,便于全班交流)",
                "黑板贴(用于张贴学生优秀作品,营造学习氛围)",
                "学习反思卡(用于课堂总结时的自我评价,每生一张)"
              ]
            }
            
            
            关键要求:
            1. 只返回JSON,无markdown标记
            2. objectives包含knowledge/skills/values三维度,各3-4项
            3. keyPoints和difficulties各3-4项,具体描述
            4. teachingSteps包含4-5个阶段(导入→新授→巩固→总结)
            5. 每个step的content 150-200字,activities 5-8项(含时间节点+具体操作)
            6. assignments 3-5项(基础+实践+拓展),resources 5-8项
            7. 体现{grade}学段特点和{subject}学科方法
            8. 不用"..."等模糊表述,给出具体内容
            """;
    }
    
    /**
     * 会话标题生成提示词模板（精简版）
     */
    @Bean("sessionTitlePromptTemplate")
    public String sessionTitlePromptTemplate() {
        return """
            根据用户消息生成会话标题(不超过15字,无标点):
            {message}
            """;
    }
    
    /**
     * 关键词提取提示词模板（精简版）
     */
    @Bean("keywordExtractionPromptTemplate")
    public String keywordExtractionPromptTemplate() {
        return """
            提取1-3个核心关键词(专业术语,去除通用词),返回JSON数组:
            {topic}
            """;
    }
    
    /**
     * 论文总结提示词模板（精简版 - 强约束JSON格式）
     */
    @Bean("paperSummaryPromptTemplate")
    public String paperSummaryPromptTemplate() {
        return """
            论文内容:
            {context}
            
            返回JSON格式论文总结,严格遵守以下结构:
            {
              "title": "字符串",
              "authors": ["字符串数组"],
              "publicationYear": 数字,
              "summary": {
                "background": "字符串-研究背景",
                "methodology": "字符串-研究方法",
                "results": "字符串-主要发现",
                "innovations": ["字符串数组-创新点"],
                "limitations": "字符串-局限性"
              },
              "keywords": ["字符串数组"]
            }
            
            关键约束:
            1. 只返回JSON,无markdown标记
            2. background/methodology/results/limitations必须是字符串(非数组)
            3. innovations/keywords必须是数组
            4. 信息缺失时:字符串用"",数组用[]
            5. 基于原文,不编造,逻辑详细,每个属性400字
            """;
    }
    
    /**
     * 论文元数据抽取提示词模板（精简版）
     */
    @Bean("paperMetadataExtractionPromptTemplate")
    public String paperMetadataExtractionPromptTemplate() {
        return """
            提取论文元数据,返回JSON:
            {context}
            
            格式: {"documentId":{documentId},"title":"","authors":[],"year":"","publication":"","volume":"","issue":"","pages":"","doi":"","keywords":[],"abstractText":"","field":""}
            
            要求: 基于原文,不编造,缺失信息用空字符串/空数组
            """;
    }
    
    /**
     * 单篇论文创新点提取提示词模板（精简版）
     */
    @Bean("innovationExtractionPromptTemplate")
    public String innovationExtractionPromptTemplate() {
        return """
            提取论文创新点,返回JSON数组:
            {context}
            
            格式: [{"description":"创新描述(突出新在哪)","noveltyScore":0.8}]
            
            类型: 新理论/算法/方法/改进/数据集/突破性成果
            要求: 基于原文,具体到技术细节,不足时返回[]
            """;
    }
    
    /**
     * 创新点聚合提示词模板（精简版）
     */
    @Bean("innovationClusteringPromptTemplate")
    public String innovationClusteringPromptTemplate() {
        return """
            聚类创新点,返回JSON:
            {innovationList}
            
            格式: [{"topic":"主题","importance":0.9,"paperCount":3,"innovations":[{"description":"","paperTitle":"","documentId":123,"noveltyScore":0.8}]}]
            
            要求: 保持documentId原值不变
            """;
    }
    
    /**
     * 论文对比提示词模板（优化版 - 明确任务和格式）
     */
    @Bean("paperComparisonPromptTemplate")
    public String paperComparisonPromptTemplate() {
        return """
            返回以下JSON结构(示例):
            {
              "dimensions": [
                {"id": "method", "name": "研究方法", "description": "各论文采用的研究方法对比"},
                {"id": "dataset", "name": "数据集", "description": "各论文使用的数据集对比"}
              ],
              "papers": [
                {"documentId": 123456, "title": "论文A完整标题", "authors": "作者名", "year": "2020"},
                {"documentId": 789012, "title": "论文B完整标题", "authors": "作者名", "year": "2021"}
              ],
              "matrix": [
                {"dimensionId": "method", "dimensionName": "研究方法", 
                 "values": ["论文A采用深度学习CNN模型", "论文B采用传统SVM方法"]},
                {"dimensionId": "dataset", "dimensionName": "数据集", 
                 "values": ["论文A使用ImageNet数据集", "论文B使用CIFAR-10数据集"]}
              ]
            }
            
            关键要求:
            1. dimensions数组长度=对比维度数，papers数组长度=论文数
            2. matrix数组长度=dimensions数组长度
            3. 每个matrix.values数组长度=papers数组长度
            4. documentId必须使用实际论文ID，descriptions要具体详细
            """;
    }
}
